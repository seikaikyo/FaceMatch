openapi: 3.0.3
info:
  title: FaceMatch ä¼æ¥­ç´šç®¡ç†ç³»çµ± API
  description: |
    FaceMatch æ‰¿æ”¬å•†ç®¡ç†ç³»çµ±çš„å®Œæ•´ REST API æ–‡æª”
    
    ## åŠŸèƒ½ç‰¹è‰²
    - ğŸ” ä¼æ¥­ç´š AD é©—è­‰ + æœ¬åœ°å¸³è™Ÿæ”¯æ´
    - ğŸ‘¥ æ‰¿æ”¬å•†ç®¡ç† (å®Œæ•´ CRUD)
    - ğŸ“‹ æ–½å·¥å–®ç®¡ç† + å¤šå±¤ç´šç°½æ ¸å·¥ä½œæµç¨‹
    - ğŸ“ å¹´åº¦è³‡æ ¼ç®¡ç† + å¿«é€Ÿæ“ä½œ
    - ğŸ‘¤ ä½¿ç”¨è€…ç®¡ç† + è§’è‰²æ¬Šé™æ§åˆ¶
    - ğŸ“Š ä¼æ¥­ç´šæ“ä½œæ—¥èªŒè¿½è¹¤
    - âš¡ FaceMatch æ•´åˆç®¡ç†
    
    ## èªè­‰æ–¹å¼
    ä½¿ç”¨ Bearer Token é€²è¡Œ API èªè­‰
    
  version: 2.1.3
  contact:
    name: FaceMatch æŠ€è¡“æ”¯æ´
    email: support@facematch.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5001
    description: é–‹ç™¼ç’°å¢ƒ
  - url: https://api.facematch.local
    description: ç”Ÿç”¢ç’°å¢ƒ

paths:
  # èªè­‰ç³»çµ±
  /api/login:
    post:
      tags:
        - èªè­‰ç³»çµ±
      summary: ä½¿ç”¨è€…ç™»å…¥
      description: æ”¯æ´ AD ç¶²åŸŸé©—è­‰å’Œæœ¬åœ°å¸³è™Ÿç™»å…¥
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: ä½¿ç”¨è€…åç¨±
                  example: "admin"
                password:
                  type: string
                  description: å¯†ç¢¼
                  example: "admin123"
                useAD:
                  type: boolean
                  description: æ˜¯å¦ä½¿ç”¨ AD é©—è­‰
                  default: false
      responses:
        '200':
          description: ç™»å…¥æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        description: JWT Token
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  # æ‰¿æ”¬å•†ç®¡ç†
  /api/contractors:
    get:
      tags:
        - æ‰¿æ”¬å•†ç®¡ç†
      summary: å–å¾—æ‰¿æ”¬å•†åˆ—è¡¨
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [ACTIVE, INACTIVE]
          description: ç¯©é¸ç‹€æ…‹
        - in: query
          name: search
          schema:
            type: string
          description: æœå°‹é—œéµå­—
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: é ç¢¼
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: æ¯é ç­†æ•¸
      responses:
        '200':
          description: æˆåŠŸå–å¾—æ‰¿æ”¬å•†åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Contractor'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
    
    post:
      tags:
        - æ‰¿æ”¬å•†ç®¡ç†
      summary: å»ºç«‹æ‰¿æ”¬å•†
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractorCreate'
      responses:
        '201':
          description: æˆåŠŸå»ºç«‹æ‰¿æ”¬å•†
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Contractor'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/contractors/{id}:
    get:
      tags:
        - æ‰¿æ”¬å•†ç®¡ç†
      summary: å–å¾—ç‰¹å®šæ‰¿æ”¬å•†
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: æ‰¿æ”¬å•† ID
      responses:
        '200':
          description: æˆåŠŸå–å¾—æ‰¿æ”¬å•†
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Contractor'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
    
    put:
      tags:
        - æ‰¿æ”¬å•†ç®¡ç†
      summary: æ›´æ–°æ‰¿æ”¬å•†
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: æ‰¿æ”¬å•† ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractorUpdate'
      responses:
        '200':
          description: æˆåŠŸæ›´æ–°æ‰¿æ”¬å•†
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Contractor'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
    
    delete:
      tags:
        - æ‰¿æ”¬å•†ç®¡ç†
      summary: åˆªé™¤æ‰¿æ”¬å•†
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: æ‰¿æ”¬å•† ID
      responses:
        '200':
          description: æˆåŠŸåˆªé™¤æ‰¿æ”¬å•†
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "æ‰¿æ”¬å•†å·²æˆåŠŸåˆªé™¤"
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  # æ–½å·¥å–®ç®¡ç†
  /api/work-orders:
    get:
      tags:
        - æ–½å·¥å–®ç®¡ç†
      summary: å–å¾—æ–½å·¥å–®åˆ—è¡¨
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [DRAFT, SUBMITTED, EHS_APPROVED, MANAGER_APPROVED, REJECTED, COMPLETED]
          description: ç¯©é¸ç‹€æ…‹
        - in: query
          name: contractorId
          schema:
            type: integer
          description: æ‰¿æ”¬å•† ID
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: é ç¢¼
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: æ¯é ç­†æ•¸
      responses:
        '200':
          description: æˆåŠŸå–å¾—æ–½å·¥å–®åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkOrder'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  # ç°½æ ¸ç®¡ç†
  /api/work-orders/pending-approval:
    get:
      tags:
        - ç°½æ ¸ç®¡ç†
      summary: å–å¾—å¾…ç°½æ ¸æ¸…å–®
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸå–å¾—å¾…ç°½æ ¸æ¸…å–®
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkOrder'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/approvals/{id}/ehs:
    post:
      tags:
        - ç°½æ ¸ç®¡ç†
      summary: è·ç’°å®‰ç°½æ ¸
      description: è·ç’°å®‰å±¤ç´šçš„ç°½æ ¸æ“ä½œ (æ ¸å‡†/é§å›)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: æ–½å·¥å–® ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [approve, reject]
                  description: ç°½æ ¸å‹•ä½œ
                comment:
                  type: string
                  description: ç°½æ ¸æ„è¦‹
                  example: "å®‰å…¨æªæ–½å®Œå‚™ï¼Œæ ¸å‡†åŸ·è¡Œ"
      responses:
        '200':
          description: ç°½æ ¸æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/WorkOrder'
                  message:
                    type: string
                    example: "è·ç’°å®‰ç°½æ ¸å®Œæˆ"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          description: ä½¿ç”¨è€… ID
          example: 1
        username:
          type: string
          description: ä½¿ç”¨è€…åç¨±
          example: "admin"
        name:
          type: string
          description: å§“å
          example: "ç³»çµ±ç®¡ç†å“¡"
        email:
          type: string
          format: email
          description: é›»å­éƒµä»¶
          example: "admin@facematch.com"
        role:
          type: string
          enum: [ADMIN, EHS, MANAGER, USER]
          description: ä½¿ç”¨è€…è§’è‰²
          example: "ADMIN"
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          description: å¸³è™Ÿç‹€æ…‹
          example: "ACTIVE"
        createdAt:
          type: string
          format: date-time
          description: å»ºç«‹æ™‚é–“
        updatedAt:
          type: string
          format: date-time
          description: æ›´æ–°æ™‚é–“

    Contractor:
      type: object
      properties:
        id:
          type: integer
          description: æ‰¿æ”¬å•† ID
          example: 1
        name:
          type: string
          description: æ‰¿æ”¬å•†åç¨±
          example: "å°ç©é›»æ‰¿æ”¬å•†"
        code:
          type: string
          description: æ‰¿æ”¬å•†ä»£ç¢¼
          example: "TSMC001"
        contact:
          type: string
          description: è¯çµ¡äºº
          example: "å¼µä¸‰"
        phone:
          type: string
          description: è¯çµ¡é›»è©±
          example: "02-1234-5678"
        email:
          type: string
          format: email
          description: é›»å­éƒµä»¶
          example: "contact@tsmc-contractor.com"
        address:
          type: string
          description: åœ°å€
          example: "æ–°ç«¹ç§‘å­¸åœ’å€"
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          description: ç‹€æ…‹
          example: "ACTIVE"
        createdAt:
          type: string
          format: date-time
          description: å»ºç«‹æ™‚é–“
        updatedAt:
          type: string
          format: date-time
          description: æ›´æ–°æ™‚é–“

    ContractorCreate:
      type: object
      required:
        - name
        - code
        - contact
        - phone
      properties:
        name:
          type: string
          description: æ‰¿æ”¬å•†åç¨±
          example: "æ–°æ‰¿æ”¬å•†"
        code:
          type: string
          description: æ‰¿æ”¬å•†ä»£ç¢¼ (å”¯ä¸€)
          example: "NEW001"
        contact:
          type: string
          description: è¯çµ¡äºº
          example: "æå››"
        phone:
          type: string
          description: è¯çµ¡é›»è©±
          example: "02-2345-6789"
        email:
          type: string
          format: email
          description: é›»å­éƒµä»¶
          example: "contact@new-contractor.com"
        address:
          type: string
          description: åœ°å€
          example: "å°åŒ—å¸‚ä¿¡ç¾©å€"
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          description: ç‹€æ…‹
          default: "ACTIVE"

    ContractorUpdate:
      type: object
      properties:
        name:
          type: string
          description: æ‰¿æ”¬å•†åç¨±
        contact:
          type: string
          description: è¯çµ¡äºº
        phone:
          type: string
          description: è¯çµ¡é›»è©±
        email:
          type: string
          format: email
          description: é›»å­éƒµä»¶
        address:
          type: string
          description: åœ°å€
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          description: ç‹€æ…‹

    WorkOrder:
      type: object
      properties:
        id:
          type: integer
          description: æ–½å·¥å–® ID
          example: 1
        title:
          type: string
          description: æ–½å·¥å–®æ¨™é¡Œ
          example: "æ©Ÿå°ç¶­è­·å·¥ç¨‹"
        description:
          type: string
          description: å·¥ä½œæè¿°
          example: "é€²è¡Œç”Ÿç”¢ç·šæ©Ÿå°å®šæœŸç¶­è­·"
        contractorId:
          type: integer
          description: æ‰¿æ”¬å•† ID
          example: 1
        contractor:
          $ref: '#/components/schemas/Contractor'
        status:
          type: string
          enum: [DRAFT, SUBMITTED, EHS_APPROVED, MANAGER_APPROVED, REJECTED, COMPLETED]
          description: æ–½å·¥å–®ç‹€æ…‹
          example: "SUBMITTED"
        startDate:
          type: string
          format: date
          description: é–‹å§‹æ—¥æœŸ
          example: "2024-01-15"
        endDate:
          type: string
          format: date
          description: çµæŸæ—¥æœŸ
          example: "2024-01-20"
        location:
          type: string
          description: æ–½å·¥åœ°é»
          example: "FAB18 2æ¨“"
        riskLevel:
          type: string
          enum: [LOW, MEDIUM, HIGH]
          description: é¢¨éšªç­‰ç´š
          example: "MEDIUM"
        createdBy:
          type: integer
          description: å»ºç«‹è€… ID
          example: 2
        createdAt:
          type: string
          format: date-time
          description: å»ºç«‹æ™‚é–“
        updatedAt:
          type: string
          format: date-time
          description: æ›´æ–°æ™‚é–“

    Pagination:
      type: object
      properties:
        page:
          type: integer
          description: ç•¶å‰é ç¢¼
          example: 1
        limit:
          type: integer
          description: æ¯é ç­†æ•¸
          example: 20
        total:
          type: integer
          description: ç¸½ç­†æ•¸
          example: 150
        totalPages:
          type: integer
          description: ç¸½é æ•¸
          example: 8

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              description: éŒ¯èª¤ä»£ç¢¼
            message:
              type: string
              description: éŒ¯èª¤è¨Šæ¯
            details:
              type: object
              description: è©³ç´°éŒ¯èª¤è³‡è¨Š

  responses:
    BadRequest:
      description: è«‹æ±‚åƒæ•¸éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "VALIDATION_ERROR"
              message: "è«‹æ±‚åƒæ•¸é©—è­‰å¤±æ•—"
              details:
                field: "name"
                message: "åç¨±ç‚ºå¿…å¡«æ¬„ä½"

    Unauthorized:
      description: æœªæˆæ¬Š - éœ€è¦ç™»å…¥
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "UNAUTHORIZED"
              message: "æœªæˆæ¬Šå­˜å–ï¼Œè«‹å…ˆç™»å…¥"

    Forbidden:
      description: ç¦æ­¢å­˜å– - æ¬Šé™ä¸è¶³
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "FORBIDDEN"
              message: "æ¬Šé™ä¸è¶³ï¼Œç„¡æ³•åŸ·è¡Œæ­¤æ“ä½œ"

    NotFound:
      description: è³‡æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "NOT_FOUND"
              message: "è«‹æ±‚çš„è³‡æºä¸å­˜åœ¨"

    InternalError:
      description: ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "INTERNAL_ERROR"
              message: "ä¼ºæœå™¨ç™¼ç”Ÿæœªé æœŸçš„éŒ¯èª¤"

tags:
  - name: èªè­‰ç³»çµ±
    description: ä½¿ç”¨è€…ç™»å…¥é©—è­‰ç›¸é—œ API
  - name: æ‰¿æ”¬å•†ç®¡ç†
    description: æ‰¿æ”¬å•† CRUD æ“ä½œ
  - name: æ–½å·¥å–®ç®¡ç†
    description: æ–½å·¥å–® CRUD æ“ä½œ
  - name: ç°½æ ¸ç®¡ç†
    description: å¤šå±¤ç´šç°½æ ¸å·¥ä½œæµç¨‹
  - name: å¹´åº¦è³‡æ ¼ç®¡ç†
    description: å¹´åº¦è³‡æ ¼ CRUD å’Œå¿«é€Ÿæ“ä½œ
  - name: ä½¿ç”¨è€…ç®¡ç†
    description: ä½¿ç”¨è€…å¸³è™Ÿå’Œè§’è‰²ç®¡ç†
  - name: FaceMatch æ•´åˆ
    description: FaceMatch ç³»çµ±æ•´åˆç®¡ç†
  - name: ä¼æ¥­ç´šæ—¥èªŒ
    description: æ“ä½œæ—¥èªŒè¿½è¹¤å’Œåˆ†æ